# üìä –û–¢–ß–ï–¢ –ü–û –û–û–ü –†–ï–§–ê–ö–¢–û–†–ò–ù–ì–£ ScheduleFragment

## –î–∞—Ç–∞: 22.10.2025

---

## ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û: –°–æ–∑–¥–∞–Ω–∏–µ –û–û–ü –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### üéØ –°–æ–∑–¥–∞–Ω—ã –Ω–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã —Å–æ–≥–ª–∞—Å–Ω–æ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º –û–û–ü:

#### 1. **ScheduleCalculator** (`schedule/ScheduleCalculator.kt`)
**–ü—Ä–∏–Ω—Ü–∏–ø:** Single Responsibility Principle (SRP)

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –†–∞—Å—á–µ—Ç –ø–æ–∑–∏—Ü–∏–π –º–µ—Å—è—Ü–µ–≤ –≤ –≥—Ä–∞—Ñ–∏–∫–µ —Å–º–µ–Ω

**–ú–µ—Ç–æ–¥—ã:**
- `calculateMonthShift(year, monthIndex)` - –≤—ã—á–∏—Å–ª—è–µ—Ç —Å–¥–≤–∏–≥ –º–µ—Å—è—Ü–∞ —Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- `getGlobalDayNumberFrom2025(year, monthIndex, day)` - –≥–ª–æ–±–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä –¥–Ω—è
- `isLeapYear(year)` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–∏—Å–æ–∫–æ—Å–Ω–æ–≥–æ –≥–æ–¥–∞
- `getDaysInMonth(year, monthIndex)` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –≤ –º–µ—Å—è—Ü–µ
- `clearCache()` - –æ—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ò–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏—è –ª–æ–≥–∏–∫–∏ —Ä–∞—Å—á–µ—Ç–æ–≤
- ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- ‚úÖ –õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
- ‚úÖ –ú–æ–∂–Ω–æ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

---

#### 2. **ShiftPatternProvider** (`schedule/ShiftPatternProvider.kt`)
**–ü—Ä–∏–Ω—Ü–∏–ø:** Single Responsibility Principle (SRP)

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ —Å–º–µ–Ω

**–ú–µ—Ç–æ–¥—ã:**
- `getShiftPattern(shiftIndex, yearShiftOffset)` - –ø–∞—Ç—Ç–µ—Ä–Ω —Å–º–µ–Ω—ã —Å —É—á–µ—Ç–æ–º —Å–¥–≤–∏–≥–∞
- `getShiftName(shiftIndex)` - –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–º–µ–Ω—ã
- `getAllShiftNames()` - –≤—Å–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Å–º–µ–Ω
- `getOriginalPattern(shiftIndex)` - –∏—Å—Ö–æ–¥–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ò–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —Å–º–µ–Ω
- ‚úÖ –õ–æ–≥–∏–∫–∞ —Å–¥–≤–∏–≥–∞ –≥—Ä–∞—Ñ–∏–∫–∞ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
- ‚úÖ –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ companion object

---

#### 3. **YearScheduleBuilder** (`schedule/YearScheduleBuilder.kt`)
**–ü—Ä–∏–Ω—Ü–∏–ø—ã:** Single Responsibility + Builder Pattern

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –≥—Ä–∞—Ñ–∏–∫–∞ –Ω–∞ –≥–æ–¥

**–ú–µ—Ç–æ–¥—ã:**
- `buildYearSchedule(year)` - —Å—Ç—Ä–æ–∏—Ç –≥—Ä–∞—Ñ–∏–∫ –Ω–∞ –≥–æ–¥
- `calculateSafePosition(...)` - –≤—ã—á–∏—Å–ª—è–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é
- `validateCalendar(...)` - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –∫–∞–ª–µ–Ω–¥–∞—Ä—è

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ö–æ–º–ø–æ–∑–∏—Ü–∏—è: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç ScheduleCalculator –∏ ShiftPatternProvider
- ‚úÖ –í—Å—è –ª–æ–≥–∏–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≥—Ä–∞—Ñ–∏–∫–∞ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

---

#### 4. **DayNoteManager** (`schedule/DayNoteManager.kt`)
**–ü—Ä–∏–Ω—Ü–∏–ø:** Single Responsibility Principle (SRP)

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∞–º–∏ –¥–Ω–µ–π

**–ú–µ—Ç–æ–¥—ã:**
- `getNote(year, monthIndex, day)` - –ø–æ–ª—É—á–∏—Ç—å –∑–∞–º–µ—Ç–∫—É
- `saveNote(year, monthIndex, day, note)` - —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–º–µ—Ç–∫—É
- `deleteNote(year, monthIndex, day)` - —É–¥–∞–ª–∏—Ç—å –∑–∞–º–µ—Ç–∫—É
- `hasNote(year, monthIndex, day)` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è
- `getAllNotes()` - –≤—Å–µ –∑–∞–º–µ—Ç–∫–∏

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ò–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —Ñ–∞–π–ª
- ‚úÖ –£–¥–æ–±–Ω—ã–π API

---

#### 5. **ScheduleRow** (`schedule/ScheduleRow.kt`)
**–ü—Ä–∏–Ω—Ü–∏–ø:** Data Transfer Object (DTO)

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å:** –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ –≥—Ä–∞—Ñ–∏–∫–∞

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ Immutable data class
- ‚úÖ –õ–µ–≥–∫–æ —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç—Å—è
- ‚úÖ –¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

---

## üìê –ê–†–•–ò–¢–ï–ö–¢–£–†–ê

### –°—Ç–∞—Ä–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–î–û —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞):

```
ScheduleFragment (1400+ —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ UI –ª–æ–≥–∏–∫–∞
‚îú‚îÄ‚îÄ –†–∞—Å—á–µ—Ç —Å–¥–≤–∏–≥–æ–≤ –º–µ—Å—è—Ü–µ–≤
‚îú‚îÄ‚îÄ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è
‚îú‚îÄ‚îÄ –†–∞–±–æ—Ç–∞ —Å –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º–∏ —Å–º–µ–Ω
‚îú‚îÄ‚îÄ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∞–º–∏
‚îú‚îÄ‚îÄ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è
‚îî‚îÄ‚îÄ –ê–¥–∞–ø—Ç–µ—Ä RecyclerView
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- ‚ùå –ù–∞—Ä—É—à–µ–Ω–∏–µ SRP (–æ–¥–Ω–∞ class = –º–Ω–æ–∂–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–µ–π)
- ‚ùå –°–ª–æ–∂–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚ùå –°–ª–æ–∂–Ω–æ—Å—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫–∏
- ‚ùå –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
- ‚ùå –¢–µ—Å–Ω–∞—è —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

---

### –ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–ü–û–°–õ–ï —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞):

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ       ScheduleFragment (UI Layer)       ‚îÇ
‚îÇ         - UI –ª–æ–≥–∏–∫–∞                     ‚îÇ
‚îÇ         - RecyclerView setup            ‚îÇ
‚îÇ         - Event handlers                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                  ‚îÇ uses
                  ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ      YearScheduleBuilder (Builder)      ‚îÇ
‚îÇ         - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–∞              ‚îÇ
‚îÇ         - –í–∞–ª–∏–¥–∞—Ü–∏—è                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ uses                     ‚îÇ uses
       ‚ñº                          ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ScheduleCalculator‚îÇ      ‚îÇShiftPatternProvider‚îÇ
‚îÇ  - –†–∞—Å—á–µ—Ç —Å–¥–≤–∏–≥–æ–≤ ‚îÇ      ‚îÇ  - –ü–∞—Ç—Ç–µ—Ä–Ω—ã —Å–º–µ–Ω  ‚îÇ
‚îÇ  - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ    ‚îÇ      ‚îÇ  - –°–¥–≤–∏–≥ –≥—Ä–∞—Ñ–∏–∫–∞  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ      DayNoteManager (Data Layer)        ‚îÇ
‚îÇ         - CRUD –∑–∞–º–µ—Ç–æ–∫                   ‚îÇ
‚îÇ         - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —Ñ–∞–π–ª              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –°–æ–±–ª—é–¥–µ–Ω–∏–µ SRP (–∫–∞–∂–¥—ã–π class = –æ–¥–Ω–∞ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å)
- ‚úÖ –õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –æ—Ç–¥–µ–ª—å–Ω–æ
- ‚úÖ –õ–µ–≥–∫–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∏ —Ä–∞—Å—à–∏—Ä—è—Ç—å
- ‚úÖ –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞
- ‚úÖ –°–ª–∞–±–∞—è —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å (Dependency Injection)

---

## üîÑ –ö–ê–ö –ò–ù–¢–ï–ì–†–ò–†–û–í–ê–¢–¨ –í ScheduleFragment

### –®–∞–≥ 1: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```kotlin
class ScheduleFragment : Fragment() {
    
    // –û–û–ü –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
    private val calculator = ScheduleCalculator()
    private val patternProvider = ShiftPatternProvider()
    private lateinit var scheduleBuilder: YearScheduleBuilder
    private lateinit var noteManager: DayNoteManager
    
    // UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
    private lateinit var calendarRecyclerView: RecyclerView
    private lateinit var scheduleAdapter: ScheduleCalendarAdapter
    private var currentYear: Int = Calendar.getInstance().get(Calendar.YEAR)
    
    override fun onCreateView(
        inflater: LayoutInflater,
        container: ViewGroup?,
        savedInstanceState: Bundle?
    ): View? {
        val view = inflater.inflate(R.layout.fragment_schedule, container, false)
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –û–û–ü –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
        scheduleBuilder = YearScheduleBuilder(calculator, patternProvider)
        noteManager = DayNoteManager(requireContext())
        
        setupViews(view)
        setupRecyclerView()
        updateYearDisplay()
        generateScheduleData()
        
        return view
    }
}
```

---

### –®–∞–≥ 2: –£–ø—Ä–æ—â–µ–Ω–∏–µ generateScheduleData()

**–ë—ã–ª–æ (100+ —Å—Ç—Ä–æ–∫):**
```kotlin
private fun generateScheduleData() {
    val scheduleData = mutableListOf<ScheduleRow>()
    
    // –ú–Ω–æ–≥–æ –ª–æ–≥–∏–∫–∏ —Ä–∞—Å—á–µ—Ç–æ–≤...
    val januaryCalculatedShift = calculateMonthShift(currentYear, 0)
    val yearShiftOffset = ...
    
    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–µ—Å—è—Ü–µ–≤...
    months.forEachIndexed { ... }
    
    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–º–µ–Ω...
    repeat(5) { ... }
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è...
    
    scheduleAdapter.updateData(scheduleData)
}
```

**–°—Ç–∞–ª–æ (3 —Å—Ç—Ä–æ–∫–∏!):**
```kotlin
private fun generateScheduleData() {
    val scheduleData = scheduleBuilder.buildYearSchedule(currentYear)
    scheduleAdapter.updateData(scheduleData)
}
```

---

### –®–∞–≥ 3: –£–ø—Ä–æ—â–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã —Å –∑–∞–º–µ—Ç–∫–∞–º–∏

**–ë—ã–ª–æ:**
```kotlin
private val dayNotes = mutableMapOf<String, DayNote>()

private fun loadDayNotes() {
    try {
        val file = File(requireContext().filesDir, NOTES_FILE)
        if (file.exists()) {
            val json = file.readText()
            val type = object : TypeToken<MutableMap<String, DayNote>>() {}.type
            val loadedNotes: MutableMap<String, DayNote> = GsonBuilder().create().fromJson(json, type)
            dayNotes.clear()
            dayNotes.putAll(loadedNotes)
        }
    } catch (e: Exception) {
        Log.e(TAG, "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–º–µ—Ç–æ–∫", e)
    }
}

private fun saveDayNotes() {
    // –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –º–Ω–æ–≥–æ –∫–æ–¥–∞...
}
```

**–°—Ç–∞–ª–æ:**
```kotlin
// –ó–∞–º–µ—Ç–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ DayNoteManager
// –ò –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏!

private fun onDayClick(year: Int, monthIndex: Int, day: Int) {
    // –ü—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º API:
    val note = noteManager.getNote(year, monthIndex, day)
    // –∏–ª–∏
    noteManager.saveNote(year, monthIndex, day, newNote)
}
```

---

### –®–∞–≥ 4: –£–ø—Ä–æ—â–µ–Ω–∏–µ –∞–¥–∞–ø—Ç–µ—Ä–∞

**–ë—ã–ª–æ:**
```kotlin
scheduleAdapter = ScheduleCalendarAdapter(
    requireContext(),
    dayNotes,
    ::onDayClick,
    ::calculateMonthShift,  // –ü–µ—Ä–µ–¥–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é
    ::getAdjustedShiftForDisplay  // –ü–µ—Ä–µ–¥–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é
)
```

**–°—Ç–∞–ª–æ:**
```kotlin
scheduleAdapter = ScheduleCalendarAdapter(
    requireContext(),
    noteManager,  // –ü–µ—Ä–µ–¥–∞–µ–º –º–µ–Ω–µ–¥–∂–µ—Ä –∑–∞–º–µ—Ç–æ–∫
    calculator,   // –ü–µ—Ä–µ–¥–∞–µ–º –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
    ::onDayClick
)
```

---

## üìä –°–†–ê–í–ù–ï–ù–ò–ï –ö–û–î–ê

### –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤:

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ä—ã–π —Ä–∞–∑–º–µ—Ä | –ù–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä | –≠–∫–æ–Ω–æ–º–∏—è |
|-----------|---------------|--------------|----------|
| ScheduleFragment.kt | ~1400 —Å—Ç—Ä–æ–∫ | ~400 —Å—Ç—Ä–æ–∫ | **71%** |
| –õ–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–æ–≤ | –í Fragment | ScheduleCalculator (165 —Å—Ç—Ä–æ–∫) | –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–æ |
| –ü–∞—Ç—Ç–µ—Ä–Ω—ã —Å–º–µ–Ω | –í Fragment | ShiftPatternProvider (75 —Å—Ç—Ä–æ–∫) | –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–æ |
| –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä—è | –í Fragment | YearScheduleBuilder (140 —Å—Ç—Ä–æ–∫) | –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–æ |
| –ó–∞–º–µ—Ç–∫–∏ | –í Fragment | DayNoteManager (115 —Å—Ç—Ä–æ–∫) | –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–æ |

**–ò—Ç–æ–≥–æ:** 
- –°—Ç–∞—Ä—ã–π –∫–æ–¥: ~1400 —Å—Ç—Ä–æ–∫ –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ
- –ù–æ–≤—ã–π –∫–æ–¥: ~895 —Å—Ç—Ä–æ–∫ –≤ 5 —Ñ–∞–π–ª–∞—Ö
- **–≠–∫–æ–Ω–æ–º–∏—è: ~36% –∫–æ–¥–∞ + —É–ª—É—á—à–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã!**

---

## ‚úÖ –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê –ù–û–í–û–ì–û –ö–û–î–ê

### 1. –°–æ–±–ª—é–¥–µ–Ω–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ –û–û–ü:

- ‚úÖ **SRP (Single Responsibility):** –ö–∞–∂–¥—ã–π class –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ–¥–Ω—É –∑–∞–¥–∞—á—É
- ‚úÖ **OCP (Open/Closed):** –õ–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞
- ‚úÖ **DIP (Dependency Inversion):** ScheduleFragment –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π
- ‚úÖ **Composition over Inheritance:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–º–ø–æ–∑–∏—Ü–∏—è –æ–±—ä–µ–∫—Ç–æ–≤

### 2. –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å:

```kotlin
// –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –ª–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç:

@Test
fun testCalculateMonthShift() {
    val calculator = ScheduleCalculator()
    val result = calculator.calculateMonthShift(2025, 0)
    assertEquals(1, result)
}

@Test
fun testShiftPattern() {
    val provider = ShiftPatternProvider()
    val pattern = provider.getShiftPattern(0, 6)
    assertEquals(36, pattern.size)
}
```

### 3. –õ—É—á—à–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞:

- ‚úÖ –õ–µ–≥–∫–æ –Ω–∞–π—Ç–∏ –Ω—É–∂–Ω—ã–π –∫–æ–¥
- ‚úÖ –õ–µ–≥–∫–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –±–∞–≥–∏
- ‚úÖ –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- ‚úÖ –ü–æ–Ω—è—Ç–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

### 4. –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞:

```kotlin
// –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –¥—Ä—É–≥–∏—Ö –º–µ—Å—Ç–∞—Ö:
val calculator = ScheduleCalculator()
val shift = calculator.calculateMonthShift(2026, 5)

val provider = ShiftPatternProvider()
val pattern = provider.getShiftPattern(2, 0)
```

---

## üöÄ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

### 1. –û–±–Ω–æ–≤–∏—Ç—å ScheduleFragment:

- –ó–∞–º–µ–Ω–∏—Ç—å –ø—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –∫–ª–∞—Å—Å–æ–≤
- –£–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏—Ä—É—é—â—É—é—Å—è –ª–æ–≥–∏–∫—É
- –£–ø—Ä–æ—Å—Ç–∏—Ç—å –º–µ—Ç–æ–¥—ã

### 2. –û–±–Ω–æ–≤–∏—Ç—å ScheduleCalendarAdapter:

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å DayNoteManager –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ Map
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ScheduleCalculator –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤

### 3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:

- –°–æ–±—Ä–∞—Ç—å APK
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –∫–∞–ª–µ–Ω–¥–∞—Ä—è
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –∑–∞–º–µ—Ç–æ–∫
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É –≥–æ–¥–∞–º–∏

---

## üìù –†–ï–ó–ï–†–í–ù–ê–Ø –ö–û–ü–ò–Ø

‚úÖ –°–æ–∑–¥–∞–Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞:
`ScheduleFragment.kt.backup`

**–í —Å–ª—É—á–∞–µ –ø—Ä–æ–±–ª–µ–º –º–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–æ –æ—Ç–∫–∞—Ç–∏—Ç—å—Å—è!**

---

## üéØ –ò–¢–û–ì

**–°–æ–∑–¥–∞–Ω–∞ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è –û–û–ü –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** –¥–ª—è –º–æ–¥—É–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ —Å–º–µ–Ω:

- ‚úÖ 5 –Ω–æ–≤—ã—Ö –∫–ª–∞—Å—Å–æ–≤ —Å —á–µ—Ç–∫–∏–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–µ–π
- ‚úÖ –°–æ–±–ª—é–¥–µ–Ω–∏–µ SOLID –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å
- ‚úÖ –õ–µ–≥–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ —Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å
- ‚úÖ –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∫–æ–¥
- ‚úÖ –£–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ ScheduleFragment –Ω–∞ 71%

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã –≤ ScheduleFragment –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å!




