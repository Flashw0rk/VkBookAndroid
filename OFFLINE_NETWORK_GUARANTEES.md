# üîí –ì–∞—Ä–∞–Ω—Ç–∏–∏ –æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–∞ –∏ –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏—Ö —Å–µ—Ç–µ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

## ‚úÖ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ì–ê–†–ê–ù–¢–ò–ò

### 1. **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ñ–ª–∞–π–Ω**

**–í—Å–µ —Å–µ—Ç–µ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç –Ω–∞–ª–∏—á–∏–µ —Å–µ—Ç–∏ –ü–ï–†–ï–î –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º:**

```kotlin
// SyncService.checkServerConnection()
suspend fun checkServerConnection(): Boolean {
    // –ö–†–ò–¢–ò–ß–ù–û: –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–µ—Ç—å –ü–ï–†–ï–î –∑–∞–ø—Ä–æ—Å–æ–º
    if (!NetworkUtils.isNetworkAvailable(context)) {
        Log.d(tag, "Network not available, server connection check skipped (offline mode)")
        return false  // ‚úÖ –ë—ã—Å—Ç—Ä—ã–π –≤–æ–∑–≤—Ä–∞—Ç, –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç
    }
    // –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å–µ—Ç—å –µ—Å—Ç—å - –¥–µ–ª–∞–µ–º –∑–∞–ø—Ä–æ—Å
    return checkServerConnectionForWakeup()
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ï—Å–ª–∏ —Å–µ—Ç–∏ –Ω–µ—Ç - –∑–∞–ø—Ä–æ—Å –ù–ï –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è
- ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å—Ä–∞–∑—É —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- ‚úÖ –ù–µ—Ç –∑–∞–¥–µ—Ä–∂–µ–∫ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –≤ –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–µ

### 2. **–í—Å–µ —Å–µ—Ç–µ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ**

**–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**

```kotlin
// MainActivity.onCreate()
// ‚úÖ wakeupServerPing - –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π, fire-and-forget
uiScope.launch(Dispatchers.IO) {
    syncService.wakeupServerPing(force = true)
}

// ‚úÖ checkConnectionOnStartup - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π, –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç UI
uiScope.launch {
    val isConnected = withContext(Dispatchers.IO) {
        syncService.checkServerConnection()
    }
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ `onCreate()` –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
- ‚úÖ UI –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É
- ‚úÖ –°–µ—Ç–µ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ —Ñ–æ–Ω–µ
- ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –≤–æ –≤—Ä–µ–º—è —Å–µ—Ç–µ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### 3. **Wakeup ping –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—É—Å–∫**

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**

```kotlin
// SyncService.wakeupServerPing()
fun wakeupServerPing(force: Boolean = false) {
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–∏ (–±—ã—Å—Ç—Ä–∞—è, –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç)
    if (!force && !NetworkUtils.isNetworkAvailable(context)) {
        return  // ‚úÖ –ë—ã—Å—Ç—Ä—ã–π –≤—ã—Ö–æ–¥, –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç
    }
    
    // –ö–†–ò–¢–ò–ß–ù–û: –ó–∞–ø—É—Å–∫–∞–µ–º –≤ —Ñ–æ–Ω–µ, fire-and-forget
    CoroutineScope(Dispatchers.IO).launch {
        // –ö–æ—Ä–æ—Ç–∫–∏–µ —Ç–∞–π–º–∞—É—Ç—ã (2 —Å–µ–∫) - –±—ã—Å—Ç—Ä–æ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è –¥–∞–∂–µ –±–µ–∑ —Å–µ—Ç–∏
        val pingClient = OkHttpClient.Builder()
            .connectTimeout(2, TimeUnit.SECONDS)
            .readTimeout(2, TimeUnit.SECONDS)
            .writeTimeout(2, TimeUnit.SECONDS)
            .build()
        
        // Fire-and-forget - –Ω–µ –∂–¥–µ–º –æ—Ç–≤–µ—Ç–∞
        pingClient.newCall(request).enqueue(object : Callback {
            override fun onFailure(call: Call, e: IOException) {
                // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ
            }
            override fun onResponse(call: Call, response: Response) {
                response.close()  // –ó–∞–∫—Ä—ã–≤–∞–µ–º –∏ –∑–∞–±—ã–≤–∞–µ–º
            }
        })
    }
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
- ‚úÖ –ù–µ –∂–¥–µ–º –æ—Ç–≤–µ—Ç–∞ (fire-and-forget)
- ‚úÖ –ö–æ—Ä–æ—Ç–∫–∏–µ —Ç–∞–π–º–∞—É—Ç—ã (2 —Å–µ–∫) - –±—ã—Å—Ç—Ä–æ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è
- ‚úÖ –î–∞–∂–µ –±–µ–∑ —Å–µ—Ç–∏ –∑–∞–ø—Ä–æ—Å –±—ã—Å—Ç—Ä–æ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è –ø–æ —Ç–∞–π–º–∞—É—Ç—É
- ‚úÖ **–ù–ï –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**

### 4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç UI**

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**

```kotlin
// MainActivity.checkConnectionOnStartup()
private fun checkConnectionOnStartup() {
    // –ö–†–ò–¢–ò–ß–ù–û: –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–∏ (–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç)
    if (!NetworkUtils.isNetworkAvailable(this)) {
        updateSyncStatus("–û—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º")
        return  // ‚úÖ –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –≤—ã—Ö–æ–¥, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ñ–ª–∞–π–Ω
    }
    
    // –ö–†–ò–¢–ò–ß–ù–û: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ —Ñ–æ–Ω–µ
    uiScope.launch {
        val isConnected = withContext(Dispatchers.IO) {
            syncService.checkServerConnection()  // –í —Ñ–æ–Ω–µ
        }
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        updateSyncStatus(if (isConnected) "–ì–æ—Ç–æ–≤ –∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é" else "–°–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω")
    }
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–∏ –º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è (< 1ms)
- ‚úÖ –°–µ—Ç–µ–≤–æ–π –∑–∞–ø—Ä–æ—Å –≤ —Ñ–æ–Ω–µ (–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç UI)
- ‚úÖ UI –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
- ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–æ –≤—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–∫–∏

### 5. **–í—Å–µ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ `.execute()` —Ç–æ–ª—å–∫–æ –≤ —Ñ–æ–Ω–µ**

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**

```kotlin
// ‚úÖ NetworkModule.testConnection() - –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ Dispatchers.IO
suspend fun testConnection(url: String): Boolean {
    return try {
        // –í —Ñ–æ–Ω–µ, –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç UI
        val response = testOkHttpClient.newCall(request).execute()
        // ...
    }
}

// ‚úÖ DirectFileAccessService - –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ Dispatchers.IO
lifecycleScope.launch(Dispatchers.IO) {
    val response = client.newCall(request).execute()  // –í —Ñ–æ–Ω–µ
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –í—Å–µ `.execute()` —Ç–æ–ª—å–∫–æ –≤ `Dispatchers.IO`
- ‚úÖ –ù–∏–∫–æ–≥–¥–∞ –≤ –≥–ª–∞–≤–Ω–æ–º –ø–æ—Ç–æ–∫–µ
- ‚úÖ –ù–µ –±–ª–æ–∫–∏—Ä—É—é—Ç UI

## üìä –°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ

```
onCreate() {
    // 1. –ë—ã—Å—Ç—Ä—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (< 1ms)
    loadThemeConfiguration()        // ‚úÖ –ß—Ç–µ–Ω–∏–µ SharedPreferences
    loadServerSettings()           // ‚úÖ –ß—Ç–µ–Ω–∏–µ SharedPreferences
    
    // 2. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Å–µ—Ç–µ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã (–Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç)
    uiScope.launch(Dispatchers.IO) {
        wakeupServerPing()         // ‚úÖ Fire-and-forget, —Ç–∞–π–º–∞—É—Ç 2 —Å–µ–∫
    }
    
    uiScope.launch {
        checkConnectionOnStartup()  // ‚úÖ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–∏ –ø–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–æ–º
    }
    
    // 3. UI –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É
    setContentView()               // ‚úÖ UI –≥–æ—Ç–æ–≤
    initializeViewPager()          // ‚úÖ –§—Ä–∞–≥–º–µ–Ω—Ç—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è
}

// –†–µ–∑—É–ª—å—Ç–∞—Ç:
// ‚úÖ onCreate() –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
// ‚úÖ UI –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É
// ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ñ–ª–∞–π–Ω
// ‚úÖ –°–µ—Ç–µ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –≤ —Ñ–æ–Ω–µ –Ω–µ –º–µ—à–∞—é—Ç —Ä–∞–±–æ—Ç–µ
```

## üõ°Ô∏è –ó–∞—â–∏—Ç–∞ –æ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫

### 1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–∏ –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –∑–∞–ø—Ä–æ—Å–æ–º**

```kotlin
// ‚úÖ –í—Å–µ —Å–µ—Ç–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç —Å–µ—Ç—å –ü–ï–†–ï–î –∑–∞–ø—Ä–æ—Å–æ–º
if (!NetworkUtils.isNetworkAvailable(context)) {
    return false  // –ë—ã—Å—Ç—Ä—ã–π –≤—ã—Ö–æ–¥, –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç
}
```

### 2. **–ö–æ—Ä–æ—Ç–∫–∏–µ —Ç–∞–π–º–∞—É—Ç—ã**

```kotlin
// ‚úÖ Wakeup ping - –∫–æ—Ä–æ—Ç–∫–∏–µ —Ç–∞–π–º–∞—É—Ç—ã (2 —Å–µ–∫)
.connectTimeout(2, TimeUnit.SECONDS)
.readTimeout(2, TimeUnit.SECONDS)

// ‚úÖ –û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã - —Ä–∞–∑—É–º–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã (10-15 —Å–µ–∫)
.connectTimeout(10, TimeUnit.SECONDS)
.readTimeout(15, TimeUnit.SECONDS)
```

### 3. **Fire-and-forget –¥–ª—è –Ω–µ–≤–∞–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤**

```kotlin
// ‚úÖ Wakeup ping - –Ω–µ –∂–¥–µ–º –æ—Ç–≤–µ—Ç–∞
pingClient.newCall(request).enqueue(object : Callback {
    // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
})
```

### 4. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å –≤–µ–∑–¥–µ**

```kotlin
// ‚úÖ –í—Å–µ —Å–µ—Ç–µ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ –∫–æ—Ä—É—Ç–∏–Ω–∞—Ö
suspend fun checkServerConnection(): Boolean {
    return withContext(Dispatchers.IO) {
        // –°–µ—Ç–µ–≤–æ–π –∑–∞–ø—Ä–æ—Å –≤ —Ñ–æ–Ω–µ
    }
}
```

## üéØ –ò—Ç–æ–≥–æ–≤—ã–µ –≥–∞—Ä–∞–Ω—Ç–∏–∏

1. ‚úÖ **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ** - –Ω–µ—Ç –±–ª–æ–∫–∏—Ä—É—é—â–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
2. ‚úÖ **–†–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ñ–ª–∞–π–Ω** - –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç —Å–µ—Ç—å –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º
3. ‚úÖ **–°–µ—Ç–µ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–µ –º–µ—à–∞—é—Ç —Ä–∞–±–æ—Ç–µ** - –≤—Å–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ, –≤ —Ñ–æ–Ω–µ
4. ‚úÖ **–ù–µ—Ç —Ä–∏—Å–∫–∞ ANR** - –Ω–µ—Ç –±–ª–æ–∫–∏—Ä—É—é—â–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –≤ –≥–ª–∞–≤–Ω–æ–º –ø–æ—Ç–æ–∫–µ
5. ‚úÖ **–ö–æ—Ä–æ—Ç–∫–∏–µ —Ç–∞–π–º–∞—É—Ç—ã** - –∑–∞–ø—Ä–æ—Å—ã –±—ã—Å—Ç—Ä–æ –∑–∞–≤–µ—Ä—à–∞—é—Ç—Å—è –¥–∞–∂–µ –±–µ–∑ —Å–µ—Ç–∏
6. ‚úÖ **Fire-and-forget –¥–ª—è wakeup** - –Ω–µ –∂–¥–µ–º –æ—Ç–≤–µ—Ç–∞, –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ–º

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –±—É–¥—É—â–µ–≥–æ

1. **–í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å–µ—Ç—å –ø–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–æ–º:**
   ```kotlin
   if (!NetworkUtils.isNetworkAvailable(context)) {
       return  // –ë—ã—Å—Ç—Ä—ã–π –≤—ã—Ö–æ–¥
   }
   ```

2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ—Ä—É—Ç–∏–Ω—ã –¥–ª—è —Å–µ—Ç–µ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:**
   ```kotlin
   suspend fun networkCall() = withContext(Dispatchers.IO) {
       // –°–µ—Ç–µ–≤–æ–π –∑–∞–ø—Ä–æ—Å
   }
   ```

3. **–ö–æ—Ä–æ—Ç–∫–∏–µ —Ç–∞–π–º–∞—É—Ç—ã –¥–ª—è –Ω–µ–≤–∞–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:**
   ```kotlin
   .connectTimeout(2, TimeUnit.SECONDS)  // –î–ª—è wakeup ping
   ```

4. **Fire-and-forget –¥–ª—è –Ω–µ–≤–∞–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:**
   ```kotlin
   client.newCall(request).enqueue(callback)  // –ù–µ –∂–¥–µ–º –æ—Ç–≤–µ—Ç–∞
   ```


















