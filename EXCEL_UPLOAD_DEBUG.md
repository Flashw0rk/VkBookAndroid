# üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã —Å –∑–∞–≥—Ä—É–∑–∫–æ–π Excel

**–î–∞—Ç–∞:** 26 –æ–∫—Ç—è–±—Ä—è 2025  
**–ü—Ä–æ–±–ª–µ–º–∞:** Excel —Ñ–∞–π–ª –ø–æ–ª—É—á–∞–µ—Ç –æ—à–∏–±–∫—É 400 –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ  
**–°—Ç–∞—Ç—É—Å:** üîç –î–û–ë–ê–í–õ–ï–ù–û –õ–û–ì–ò–†–û–í–ê–ù–ò–ï

---

## üêõ –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–∞–π–ª–æ–≤ –∏–∑ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞:
- ‚úÖ JSON —Ñ–∞–π–ª (`armature_coords.json`) –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ (HTTP 200)
- ‚ùå Excel —Ñ–∞–π–ª (`Armatures.xlsx`) –ø–æ–ª—É—á–∞–µ—Ç –æ—à–∏–±–∫—É 400 (Bad Request)

### –ò–∑ –ª–æ–≥–æ–≤:
```
–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞: JSON: OK, Excel: –æ—à–∏–±–∫–∞ 400
```

---

## üîç –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ

### –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫:

–í `EditorUploadService.kt` –¥–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö –æ—à–∏–±–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏:

```kotlin
// –õ–æ–≥–∏—Ä—É–µ–º –¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏
val errorBodyStr = try { resp.errorBody()?.string() } catch (_: Exception) { null }
Log.e("EditorUploadService", "Excel upload failed: code=${resp.code()}, message=${resp.message()}, body=$errorBodyStr")
```

–¢–µ–ø–µ—Ä—å –≤ –ª–æ–≥–∞—Ö –±—É–¥–µ—Ç –≤–∏–¥–Ω–æ:
- HTTP –∫–æ–¥ –æ—à–∏–±–∫–∏
- –°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
- –¢–µ–ª–æ –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–∞ (—á—Ç–æ –∏–º–µ–Ω–Ω–æ —Å–µ—Ä–≤–µ—Ä –Ω–µ –ø—Ä–∏–Ω—è–ª)

---

## üí° –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –æ—à–∏–±–∫–∏ 400

### 1. –°–µ—Ä–≤–µ—Ä –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç Excel —á–µ—Ä–µ–∑ —ç—Ç–æ—Ç —ç–Ω–¥–ø–æ–∏–Ω—Ç
- **–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `api/updates/upload?filename=Armatures.xlsx`
- –ú–æ–∂–µ—Ç –±—ã—Ç—å —Å–µ—Ä–≤–µ—Ä –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–æ–ª—å–∫–æ JSON —á–µ—Ä–µ–∑ —ç—Ç–æ—Ç —ç–Ω–¥–ø–æ–∏–Ω—Ç

### 2. –¢—Ä–µ–±—É–µ—Ç—Å—è admin –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- –í –∫–æ–¥–µ –µ—Å—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã `adminLogin` –∏ `adminPassword`
- –í–æ–∑–º–æ–∂–Ω–æ —Å–µ—Ä–≤–µ—Ä —Ç—Ä–µ–±—É–µ—Ç admin credentials –¥–ª—è Excel

### 3. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞
- Content-Type: `application/vnd.openxmlformats-officedocument.spreadsheetml.sheet`
- –í–æ–∑–º–æ–∂–Ω–æ —Å–µ—Ä–≤–µ—Ä –æ–∂–∏–¥–∞–µ—Ç –¥—Ä—É–≥–æ–π —Ñ–æ—Ä–º–∞—Ç

### 4. –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞
- Excel —Ñ–∞–π–ª –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∏–º

---

## üîÑ –ö–∞–∫ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–∞–π–ª—ã

### JSON –∏ Excel –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç:

```kotlin
// ArmatureApiService.kt —Å—Ç—Ä–æ–∫–∞ 94
@Multipart
@POST("api/updates/upload")
suspend fun uploadUpdatesFile(
    @Part file: MultipartBody.Part,
    @Query("filename") filename: String? = null,
    @Header("X-Admin-Login") adminLogin: String? = null,
    @Header("X-Admin-Password") adminPassword: String? = null
): Response<UploadResponse>
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `file` - —Å–∞–º —Ñ–∞–π–ª
- `filename` - –∏–º—è —Ñ–∞–π–ª–∞ (query –ø–∞—Ä–∞–º–µ—Ç—Ä)
- `adminLogin` - –ª–æ–≥–∏–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `adminPassword` - –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

## üìä –¢–µ–∫—É—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

### –ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –±–µ–∑ admin –ø–∞—Ä–æ–ª—è:
- ‚úÖ JSON –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ
- ‚ùå Excel –ø–æ–ª—É—á–∞–µ—Ç –æ—à–∏–±–∫—É 400

### –ß—Ç–æ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è:
```kotlin
Log.e("EditorUploadService", "Excel upload failed: code=400, message=Bad Request, body=[–æ—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞]")
```

---

## üîß –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ

### 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –Ω–æ–≤—ã–º –∫–æ–¥–æ–º
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º

### 2. –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å Excel —Ñ–∞–π–ª
- –û—Ç–∫—Ä—ã—Ç—å —Ä–µ–¥–∞–∫—Ç–æ—Ä
- –ò–∑–º–µ–Ω–∏—Ç—å —á—Ç–æ-—Ç–æ
- –ù–∞–∂–∞—Ç—å "–û—Ç–ø—Ä–∞–≤–∏—Ç—å"

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
- –ù–∞–π—Ç–∏ —Å—Ç—Ä–æ–∫—É `Excel upload failed`
- –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —á—Ç–æ –≤ –ø–æ–ª–µ `body=`
- –ü—Ä–∏—Å–ª–∞—Ç—å —ç—Ç–æ—Ç –ª–æ–≥

### 4. –í–∞—Ä–∏–∞–Ω—Ç—ã —Ä–µ—à–µ–Ω–∏—è:
- –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä —Ç—Ä–µ–±—É–µ—Ç admin –ø–∞—Ä–æ–ª—å ‚Üí –¥–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
- –ï—Å–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π
- –ï—Å–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç ‚Üí –∏–∑–º–µ–Ω–∏—Ç—å Content-Type

---

## üìù –í–∞–∂–Ω–æ

**–û—à–∏–±–∫–∞ 400 –æ–∑–Ω–∞—á–∞–µ—Ç —á—Ç–æ –∑–∞–ø—Ä–æ—Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π.**

–°–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—Ä–≥–∞–µ—Ç –∑–∞–ø—Ä–æ—Å, –Ω–æ –±–µ–∑ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ –ø–æ—á–µ–º—É. –î–æ–±–∞–≤–ª–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∫–∞–∂–µ—Ç —Ç–æ—á–Ω—É—é –ø—Ä–∏—á–∏–Ω—É.

---

## ‚úÖ –ò—Ç–æ–≥

**–î–æ–±–∞–≤–ª–µ–Ω–æ:** –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ Excel –∑–∞–≥—Ä—É–∑–∫–∏  
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é  
**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –û—Ç–ø—Ä–∞–≤–∏—Ç—å Excel –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏

