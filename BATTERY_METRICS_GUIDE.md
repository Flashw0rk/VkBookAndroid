# üìä –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –ø—Ä–æ—Å–º–æ—Ç—Ä—É –º–µ—Ç—Ä–∏–∫ –±–∞—Ç–∞—Ä–µ–∏

## üîç –ë—ã—Å—Ç—Ä—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

### –°–ø–æ—Å–æ–± 1: Android Studio Logcat (–°–ê–ú–´–ô –ü–†–û–°–¢–û–ô)

1. –û—Ç–∫—Ä–æ–π—Ç–µ Android Studio
2. –í–Ω–∏–∑—É –Ω–∞–π–¥–∏—Ç–µ –≤–∫–ª–∞–¥–∫—É **Logcat**
3. –í –ø–æ–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞ –≤–≤–µ–¥–∏—Ç–µ: `tag:Battery`
4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –≤—ã–ø–æ–ª–Ω—è–π—Ç–µ –¥–µ–π—Å—Ç–≤–∏—è
5. –ú–µ—Ç—Ä–∏–∫–∏ –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:**
```
Battery: FileWatcher: file changed: /data/user/0/.../–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–æ–≤–µ—Ä–æ–∫ .xlsx
Battery: SyncService: wakeup ping sent
Battery: SyncService: syncAll started
Battery: SyncService: syncAll completed in 2345ms, success=true, files=3
Battery: ChecksScheduleFragment: hour changed from 10 to 11
Battery: MainActivity: sync started
Battery: MainActivity: sync completed in 2500ms, success=true
```

### –°–ø–æ—Å–æ–± 2: ADB –≤ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ

**Windows PowerShell:**
```powershell
adb logcat -s Battery
```

**–î–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ —Ñ–∞–π–ª:**
```powershell
adb logcat -s Battery > battery_metrics.txt
```

**–ü—Ä–æ—Å–º–æ—Ç—Ä —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –º–µ—Ç–∫–∞–º–∏:**
```powershell
adb logcat -s Battery -v time
```

**–û—á–∏—Å—Ç–∫–∞ –ª–æ–≥–æ–≤ –∏ –Ω–∞—á–∞–ª–æ –∑–∞–ø–∏—Å–∏ –∑–∞–Ω–æ–≤–æ:**
```powershell
adb logcat -c
adb logcat -s Battery -v time > battery_metrics.txt
```

### –°–ø–æ—Å–æ–± 3: –§–∏–ª—å—Ç—Ä –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º —Ç–µ–≥–∞–º

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –≤–∏–¥–µ—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –±–∞—Ç–∞—Ä–µ–∏ + –æ–±—ã—á–Ω—ã–µ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
```powershell
adb logcat Battery:* DataRefreshManager:* SyncService:* MainActivity:* ChecksScheduleFragment:*
```

---

## üìà –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —á–µ—Ä–µ–∑ Battery Historian

### –®–∞–≥ 1: –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö

1. **–°–±—Ä–æ—Å–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –±–∞—Ç–∞—Ä–µ–∏:**
   ```powershell
   adb shell dumpsys batterystats --reset
   ```

2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ** (–≤—ã–ø–æ–ª–Ω–∏—Ç—å –¥–µ–π—Å—Ç–≤–∏—è, –∫–æ—Ç–æ—Ä—ã–µ —Ö–æ—Ç–∏—Ç–µ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å)

3. **–°–æ–±—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ:**
   ```powershell
   adb shell dumpsys batterystats > batterystats.txt
   ```

4. **–°–æ–±—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ –¥–ª—è Battery Historian:**
   ```powershell
   adb shell dumpsys batterystats --history > batterystats_history.txt
   ```

### –®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Battery Historian

**–í–∞—Ä–∏–∞–Ω—Ç A: –û–Ω–ª–∞–π–Ω –≤–µ—Ä—Å–∏—è (—Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π)**
1. –û—Ç–∫—Ä–æ–π—Ç–µ: https://battery-historian.web.app/
2. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª `batterystats.txt`
3. –ù–∞–∂–º–∏—Ç–µ "Submit"

**–í–∞—Ä–∏–∞–Ω—Ç B: –õ–æ–∫–∞–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ (–¥–ª—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö)**
```bash
# –¢—Ä–µ–±—É–µ—Ç—Å—è Go –∏ Python
go get -u github.com/google/battery-historian/...
cd $GOPATH/src/github.com/google/battery-historian
go run cmd/battery-historian/battery-historian.go
# –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:9999
```

### –®–∞–≥ 3: –ê–Ω–∞–ª–∏–∑ –º–µ—Ç—Ä–∏–∫

–í Battery Historian –≤—ã —É–≤–∏–¥–∏—Ç–µ:
- **–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**
- **Wake locks** (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø—Ä–æ–±—É–∂–¥–µ–Ω–∏—è)
- **CPU usage** (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞)
- **Network activity** (—Å–µ—Ç–µ–≤–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å)
- **Custom events** (–Ω–∞—à–∏ –º–µ—Ç—Ä–∏–∫–∏ —Å —Ç–µ–≥–æ–º "Battery")

---

## üéØ –ß—Ç–æ –æ–∑–Ω–∞—á–∞—é—Ç –º–µ—Ç—Ä–∏–∫–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | –ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç | –ö–æ–≥–¥–∞ –ø–æ—è–≤–ª—è–µ—Ç—Å—è |
|---------|----------------|------------------|
| `FileWatcher: file changed` | –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ | –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ Excel/JSON —Ñ–∞–π–ª–æ–≤ |
| `SyncService: wakeup ping sent` | Ping –Ω–∞ —Å–µ—Ä–≤–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω | –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–º–∞–∫—Å. 1 —Ä–∞–∑ –≤ 5 –º–∏–Ω) |
| `SyncService: syncAll started` | –ù–∞—á–∞–ª–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ | –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–û–±–Ω–æ–≤–∏—Ç—å –±–∞–∑—ã" |
| `SyncService: syncAll completed` | –ö–æ–Ω–µ—Ü —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ + –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ |
| `ChecksScheduleFragment: hour changed` | –ò–∑–º–µ–Ω–µ–Ω–∏–µ —á–∞—Å–∞ | –ö–∞–∂–¥—ã–π —á–∞—Å (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ) |
| `MainActivity: sync started/completed` | –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤ MainActivity | –ü—Ä–∏ —Ä—É—á–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ |

---

## üí° –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

**–ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –ª–æ–≥–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**
```powershell
adb logcat | Select-String "VkBookAndroid|Battery|DataRefreshManager|SyncService"
```

**–û—á–∏—Å—Ç–∫–∞ –ª–æ–≥–æ–≤:**
```powershell
adb logcat -c
```

**–ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ —Å —É—Ä–æ–≤–Ω–µ–º DEBUG –∏ –≤—ã—à–µ:**
```powershell
adb logcat Battery:D *:S
```

**–≠–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–æ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –º–∏–Ω—É—Ç:**
```powershell
adb logcat -t "$(date -d '5 minutes ago' +%m-%d\ %H:%M:%S)" -s Battery > recent_battery_logs.txt
```

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –≤ Android Studio

1. –í Logcat –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –∏–∫–æ–Ω–∫—É —Ñ–∏–ª—å—Ç—Ä–∞ (–≤–æ—Ä–æ–Ω–∫–∞)
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ñ–∏–ª—å—Ç—Ä:
   - **Name:** Battery Metrics
   - **Log Tag:** Battery
   - **Log Level:** Debug
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ

---

## üì± –ü—Ä–æ—Å–º–æ—Ç—Ä –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ (–±–µ–∑ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞)

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –ø—Ä—è–º–æ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ:

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ **Log Viewer** –∏–ª–∏ **aLogcat** –∏–∑ Google Play
2. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
3. –ù–∞–π–¥–∏—Ç–µ —Ç–µ–≥ `Battery`
4. –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–π—Ç–µ –º–µ—Ç—Ä–∏–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

---

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

- –ú–µ—Ç—Ä–∏–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ **DEBUG** —Ä–µ–∂–∏–º–µ
- –í **RELEASE** —Å–±–æ—Ä–∫–µ –ª–æ–≥–∏ —Å —Ç–µ–≥–æ–º "Battery" –º–æ–≥—É—Ç –±—ã—Ç—å —É–¥–∞–ª–µ–Ω—ã ProGuard
- –î–ª—è production –∞–Ω–∞–ª–∏–∑–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Firebase Performance Monitoring –∏–ª–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å –∞–Ω–∞–ª–∏—Ç–∏–∫–∏



