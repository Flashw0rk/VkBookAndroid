# HTTP/1.1 vs HTTP/2: ÐÐ½Ð°Ð»Ð¸Ð· Ð´Ð»Ñ VkBookAndroid

## ðŸ“Š Ð Ð°Ð·Ð»Ð¸Ñ‡Ð¸Ñ Ð¿Ñ€Ð¾Ñ‚Ð¾ÐºÐ¾Ð»Ð¾Ð²

### HTTP/1.1 (Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ ÑÐµÐ¹Ñ‡Ð°Ñ)
```
âœ… ÐŸÑ€ÐµÐ¸Ð¼ÑƒÑ‰ÐµÑÑ‚Ð²Ð°:
- ÐŸÑ€Ð¾ÑÑ‚Ð¾Ñ‚Ð° Ð¸ Ð¿Ñ€ÐµÐ´ÑÐºÐ°Ð·ÑƒÐµÐ¼Ð¾ÑÑ‚ÑŒ
- ÐšÐ°Ð¶Ð´Ñ‹Ð¹ Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð½ÐµÐ·Ð°Ð²Ð¸ÑÐ¸Ð¼
- Ð›ÐµÐ³ÐºÐ¾ Ð¾Ñ‚Ð»Ð°Ð¶Ð¸Ð²Ð°Ñ‚ÑŒ
- ÐÐ°Ð´ÐµÐ¶Ð½Ð°Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ð° Ñ ÐºÑÑˆÐµÐ¼
- Ð›ÑƒÑ‡ÑˆÐµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ñ Render.com (Ñ…Ð¾Ð»Ð¾Ð´Ð½Ñ‹Ð¹ ÑÑ‚Ð°Ñ€Ñ‚)

âŒ ÐÐµÐ´Ð¾ÑÑ‚Ð°Ñ‚ÐºÐ¸:
- ÐœÐµÐ´Ð»ÐµÐ½Ð½ÐµÐµ Ð¿Ñ€Ð¸ Ð¼Ð½Ð¾Ð¶ÐµÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ñ… Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°Ñ…
- Ð‘Ð¾Ð»ÑŒÑˆÐµ overhead Ð½Ð° ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ
```

### HTTP/2 (Ð±Ñ‹Ð»Ð¾ Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ)
```
âœ… ÐŸÑ€ÐµÐ¸Ð¼ÑƒÑ‰ÐµÑÑ‚Ð²Ð°:
- ÐœÑƒÐ»ÑŒÑ‚Ð¸Ð¿Ð»ÐµÐºÑÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ (Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð² Ð² Ð¾Ð´Ð½Ð¾Ð¼ ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ð¸)
- Server Push (ÑÐµÑ€Ð²ÐµÑ€ Ð¼Ð¾Ð¶ÐµÑ‚ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÑ‚ÑŒ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð·Ð°Ñ€Ð°Ð½ÐµÐµ)
- Ð¡Ð¶Ð°Ñ‚Ð¸Ðµ Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²ÐºÐ¾Ð² (HPACK)
- Ð‘Ñ‹ÑÑ‚Ñ€ÐµÐµ Ð¿Ñ€Ð¸ Ð¼Ð½Ð¾Ð¶ÐµÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ñ… Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°Ñ…

âŒ ÐÐµÐ´Ð¾ÑÑ‚Ð°Ñ‚ÐºÐ¸:
- Ð¡Ð»Ð¾Ð¶Ð½ÐµÐµ Ð¾Ñ‚Ð»Ð°Ð¶Ð¸Ð²Ð°Ñ‚ÑŒ
- ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹ Ñ ÐºÑÑˆÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð¸ÐµÐ¼ (Ð¼Ð¾Ð¶ÐµÑ‚ Ð¸Ð³Ð½Ð¾Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Cache-Control)
- ÐŸÐµÑ€ÐµÐ¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ð¹ Ð¼Ð¾Ð¶ÐµÑ‚ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°Ñ‚ÑŒ ÑÑ‚Ð°Ñ€Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ
- ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹ Ñ Render.com Ð¿Ñ€Ð¸ Ñ…Ð¾Ð»Ð¾Ð´Ð½Ð¾Ð¼ ÑÑ‚Ð°Ñ€Ñ‚Ðµ
```

## ðŸ” ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð° Ñ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸ÑÐ¼Ð¸ Ð¿Ñ€Ð¸ HTTP/2

### ÐŸÐ¾Ñ‡ÐµÐ¼Ñƒ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ Ð½Ðµ Ð²ÑÐµÐ³Ð´Ð° Ð¿Ñ€Ð¸Ñ…Ð¾Ð´Ð¸Ð»Ð¸:

1. **ÐœÑƒÐ»ÑŒÑ‚Ð¸Ð¿Ð»ÐµÐºÑÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¸ ÐºÑÑˆ**
   ```
   HTTP/2: ÐžÐ´Ð½Ð¾ ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ Ð´Ð»Ñ Ð²ÑÐµÑ… Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð²
   â†’ OkHttp Ð¼Ð¾Ð¶ÐµÑ‚ Ð¿ÐµÑ€ÐµÐ¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ
   â†’ ÐšÑÑˆ Ð¼Ð¾Ð¶ÐµÑ‚ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°Ñ‚ÑŒ ÑÑ‚Ð°Ñ€Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ
   â†’ ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ Ð½Ðµ Ð¿Ñ€Ð¸Ñ…Ð¾Ð´ÑÑ‚
   ```

2. **Server Push Ð¸ Ð°Ð³Ñ€ÐµÑÑÐ¸Ð²Ð½Ð¾Ðµ ÐºÑÑˆÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ**
   ```
   HTTP/2 Ð¼Ð¾Ð¶ÐµÑ‚ ÐºÑÑˆÐ¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¾Ñ‚Ð²ÐµÑ‚Ñ‹ Ð½Ð° ÑƒÑ€Ð¾Ð²Ð½Ðµ ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ñ
   â†’ Ð”Ð°Ð¶Ðµ Ñ Cache-Control: no-cache Ð¼Ð¾Ð¶ÐµÑ‚ Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ ÑÑ‚Ð°Ñ€Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ
   â†’ ÐžÑÐ¾Ð±ÐµÐ½Ð½Ð¾ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ð°Ñ‚Ð¸Ñ‡Ð½Ð¾ Ð´Ð»Ñ /api/updates/check
   ```

3. **Render.com Ð¸ Ñ…Ð¾Ð»Ð¾Ð´Ð½Ñ‹Ð¹ ÑÑ‚Ð°Ñ€Ñ‚**
   ```
   Render.com Ð¿Ñ€Ð¸ Ñ…Ð¾Ð»Ð¾Ð´Ð½Ð¾Ð¼ ÑÑ‚Ð°Ñ€Ñ‚Ðµ:
   - HTTP/2 Ð¼Ð¾Ð¶ÐµÑ‚ Ð·Ð°Ð²Ð¸ÑÐ½ÑƒÑ‚ÑŒ Ð½Ð° ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐµ ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ñ
   - Ð¢Ð°Ð¹Ð¼Ð°ÑƒÑ‚Ñ‹ Ð¿Ñ€Ð¸ Ð¼ÑƒÐ»ÑŒÑ‚Ð¸Ð¿Ð»ÐµÐºÑÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ð¸
   - HTTP/1.1 Ð±Ð¾Ð»ÐµÐµ Ð½Ð°Ð´ÐµÐ¶ÐµÐ½ Ð´Ð»Ñ "Ð¿Ñ€Ð¾Ð±ÑƒÐ¶Ð´ÐµÐ½Ð¸Ñ" ÑÐµÑ€Ð²ÐµÑ€Ð°
   ```

4. **ÐŸÐµÑ€ÐµÐ¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ð¹**
   ```
   HTTP/2: Ð¡Ð¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ Ð¾ÑÑ‚Ð°ÐµÑ‚ÑÑ Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ñ‹Ð¼
   â†’ ÐœÐ¾Ð¶ÐµÑ‚ Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ ÐºÑÑˆÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ Ð¾Ñ‚Ð²ÐµÑ‚ Ð²Ð¼ÐµÑÑ‚Ð¾ ÑÐ²ÐµÐ¶ÐµÐ³Ð¾
   â†’ HTTP/1.1: ÐšÐ°Ð¶Ð´Ñ‹Ð¹ Ð·Ð°Ð¿Ñ€Ð¾Ñ = Ð½Ð¾Ð²Ð¾Ðµ ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ = ÑÐ²ÐµÐ¶Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ
   ```

## âœ… Ð ÐµÑˆÐµÐ½Ð¸Ðµ

### ÐŸÑ€Ð¸Ð½ÑƒÐ´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ðµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ HTTP/1.1

**Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ:**
1. `NetworkModule.okHttpClient` - Ð¿Ñ€Ð¸Ð½ÑƒÐ´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ HTTP/1.1
2. `NetworkModule.testConnection()` - Ð¿Ñ€Ð¸Ð½ÑƒÐ´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ HTTP/1.1
3. `SyncService.wakeupServerPing()` - ÑƒÐ¶Ðµ Ð±Ñ‹Ð»Ð¾ HTTP/1.1

**Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:**
- âœ… ÐÐ°Ð´ÐµÐ¶Ð½Ñ‹Ðµ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ (ÐºÐ°Ð¶Ð´Ñ‹Ð¹ Ð·Ð°Ð¿Ñ€Ð¾Ñ = ÑÐ²ÐµÐ¶Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ)
- âœ… ÐŸÑ€ÐµÐ´ÑÐºÐ°Ð·ÑƒÐµÐ¼Ð¾Ðµ Ð¿Ð¾Ð²ÐµÐ´ÐµÐ½Ð¸Ðµ ÐºÑÑˆÐ°
- âœ… Ð›ÑƒÑ‡ÑˆÐ°Ñ ÑÐ¾Ð²Ð¼ÐµÑÑ‚Ð¸Ð¼Ð¾ÑÑ‚ÑŒ Ñ Render.com
- âœ… Ð›ÐµÐ³Ñ‡Ðµ Ð¾Ñ‚Ð»Ð°Ð¶Ð¸Ð²Ð°Ñ‚ÑŒ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹

## ðŸ“ˆ ÐŸÑ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ

### HTTP/1.1 Ð´Ð»Ñ Ð½Ð°ÑˆÐµÐ³Ð¾ ÑÐ»ÑƒÑ‡Ð°Ñ:

**Ð”Ð»Ñ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ VkBookAndroid:**
- ÐÐµÐ±Ð¾Ð»ÑŒÑˆÐ¾Ðµ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð² (Ð½Ðµ Ð½ÑƒÐ¶ÐµÐ½ HTTP/2)
- ÐšÑ€Ð¸Ñ‚Ð¸Ñ‡Ð½Ð° Ð½Ð°Ð´ÐµÐ¶Ð½Ð¾ÑÑ‚ÑŒ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ð¹ (HTTP/1.1 Ð»ÑƒÑ‡ÑˆÐµ)
- Render.com Ð»ÑƒÑ‡ÑˆÐµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ñ HTTP/1.1
- ÐŸÑ€Ð¾ÑÑ‚Ð¾Ñ‚Ð° Ð¾Ñ‚Ð»Ð°Ð´ÐºÐ¸ Ð²Ð°Ð¶Ð½ÐµÐµ ÑÐºÐ¾Ñ€Ð¾ÑÑ‚Ð¸

**ÐŸÐ¾Ñ‚ÐµÑ€Ð¸ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚Ð¸ Ð¼Ð¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ñ‹:**
- Ð—Ð°Ð¿Ñ€Ð¾ÑÑ‹ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ð¹ Ñ€ÐµÐ´ÐºÐ¸Ðµ (Ñ€Ð°Ð· Ð² Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ð¼Ð¸Ð½ÑƒÑ‚)
- Ð Ð°Ð·Ð¼ÐµÑ€ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð½ÐµÐ±Ð¾Ð»ÑŒÑˆÐ¾Ð¹ (Excel, JSON Ñ„Ð°Ð¹Ð»Ñ‹)
- HTTP/1.1 Ð´Ð¾ÑÑ‚Ð°Ñ‚Ð¾Ñ‡Ð½Ð¾ Ð±Ñ‹ÑÑ‚Ñ€ Ð´Ð»Ñ Ð½Ð°ÑˆÐ¸Ñ… Ð½ÑƒÐ¶Ð´

## ðŸŽ¯ Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸

1. **Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ HTTP/1.1** Ð´Ð»Ñ Ð²ÑÐµÑ… Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð² Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ð¹ âœ…
2. **ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ñ‚ÑŒ Ð»Ð¾Ð³Ð¸** Ð´Ð»Ñ Ð²Ñ‹ÑÐ²Ð»ÐµÐ½Ð¸Ñ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼
3. **ÐŸÑ€Ð¸ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ÑÑ‚Ð¸** Ð¼Ð¾Ð¶Ð½Ð¾ Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒÑÑ Ðº HTTP/2, Ð½Ð¾ Ñ ÑÐ²Ð½Ñ‹Ð¼ Ð¾Ñ‚ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸ÐµÐ¼ ÐºÑÑˆÐ°

## ðŸ“ Ð¢ÐµÑ…Ð½Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð´ÐµÑ‚Ð°Ð»Ð¸

### OkHttp Ð¿Ñ€Ð¾Ñ‚Ð¾ÐºÐ¾Ð»Ñ‹ Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ:
```kotlin
// Ð‘Ð•Ð— ÑƒÐºÐ°Ð·Ð°Ð½Ð¸Ñ Ð¿Ñ€Ð¾Ñ‚Ð¾ÐºÐ¾Ð»Ð°:
// OkHttp Ð¿Ñ‹Ñ‚Ð°ÐµÑ‚ÑÑ HTTP/2 â†’ HTTP/1.1 â†’ HTTP/1.0

// Ð¡ ÑÐ²Ð½Ñ‹Ð¼ ÑƒÐºÐ°Ð·Ð°Ð½Ð¸ÐµÐ¼:
.protocols(listOf(okhttp3.Protocol.HTTP_1_1))
// Ð¢Ð¾Ð»ÑŒÐºÐ¾ HTTP/1.1
```

### ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼Ð¾Ð³Ð¾ Ð¿Ñ€Ð¾Ñ‚Ð¾ÐºÐ¾Ð»Ð°:
```kotlin
// Ð’ Ð»Ð¾Ð³Ð°Ñ… OkHttp Ð¼Ð¾Ð¶Ð½Ð¾ ÑƒÐ²Ð¸Ð´ÐµÑ‚ÑŒ:
// "--> GET https://vkbookserver.onrender.com/api/updates/check"
// "<-- 200 OK (1234ms)"
// "protocol: http/1.1" â† ÑÑ‚Ð¾ Ð¿Ð¾ÐºÐ°Ð¶ÐµÑ‚ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼Ñ‹Ð¹ Ð¿Ñ€Ð¾Ñ‚Ð¾ÐºÐ¾Ð»
```

## ðŸ”§ Ð•ÑÐ»Ð¸ Ð½ÑƒÐ¶Ð½Ð¾ Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒÑÑ Ðº HTTP/2

Ð•ÑÐ»Ð¸ Ð² Ð±ÑƒÐ´ÑƒÑ‰ÐµÐ¼ Ð¿Ð¾Ð½Ð°Ð´Ð¾Ð±Ð¸Ñ‚ÑÑ HTTP/2:

1. **Ð¯Ð²Ð½Ð¾ Ð¾Ñ‚ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ ÐºÑÑˆ Ð´Ð»Ñ ÐºÑ€Ð¸Ñ‚Ð¸Ñ‡Ð½Ñ‹Ñ… Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð²:**
```kotlin
.request()
.newBuilder()
.cacheControl(CacheControl.FORCE_NETWORK)
.build()
```

2. **Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Connection: close Ð´Ð»Ñ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ð¹:**
```kotlin
.addHeader("Connection", "close")
```

3. **ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ñ‚ÑŒ Ð»Ð¾Ð³Ð¸ Ð´Ð»Ñ Ð²Ñ‹ÑÐ²Ð»ÐµÐ½Ð¸Ñ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼**

ÐÐ¾ Ð´Ð»Ñ Ñ‚ÐµÐºÑƒÑ‰ÐµÐ³Ð¾ ÑÐ»ÑƒÑ‡Ð°Ñ **HTTP/1.1 Ð¾Ð¿Ñ‚Ð¸Ð¼Ð°Ð»ÐµÐ½** âœ…







