# Инструкция по запуску тестов

## Проблема: Тесты не запускаются в Android Studio

### Возможные причины и решения:

## 1. Unit тесты (работают без устройства)

### Через командную строку:
```bash
# Все unit тесты
.\gradlew.bat test

# Конкретный тестовый класс
.\gradlew.bat test --tests "com.example.vkbookandroid.VkBookAndroidTests"

# Все тесты через Suite
.\gradlew.bat test -Ptest.single=AllUnitTestsSuite
```

### Через Android Studio:
1. **Синхронизация Gradle:**
   - File → Sync Project with Gradle Files
   - Или нажмите кнопку "Sync Now" в верхней панели

2. **Проверка структуры проекта:**
   - Убедитесь, что папка `app/src/test/java` помечена как "Test Sources Root"
   - Правый клик на папке → Mark Directory as → Test Sources Root

3. **Запуск тестов:**
   - Откройте файл `app/src/test/java/com/example/vkbookandroid/VkBookAndroidTests.kt`
   - Правый клик на имени класса или метода → Run 'VkBookAndroidTests'
   - Или используйте зеленые стрелки слева от методов

4. **Если тесты не видны:**
   - Build → Rebuild Project
   - File → Invalidate Caches → Invalidate and Restart

## 2. Инструментальные тесты (требуют устройство/эмулятор)

### Требования:
- **Обязательно:** Подключенное Android устройство или запущенный эмулятор
- Проверка: `adb devices` должен показать устройство

### Через командную строку:
```bash
# Проверка подключенных устройств
adb devices

# Все инструментальные тесты
.\gradlew.bat connectedDebugAndroidTest

# Конкретный тестовый класс
.\gradlew.bat connectedDebugAndroidTest -Pandroid.testInstrumentationRunnerArguments.class=com.example.vkbookandroid.VkBookAndroidInstrumentedTests

# Все тесты через Suite
.\gradlew.bat connectedDebugAndroidTest -Pandroid.testInstrumentationRunnerArguments.class=com.example.vkbookandroid.AllTestsSuite
```

### Через Android Studio:
1. **Подключите устройство или запустите эмулятор:**
   - Tools → Device Manager → Create Device (для эмулятора)
   - Или подключите физическое устройство через USB

2. **Проверка устройства:**
   - Внизу Android Studio должна быть вкладка "Device Manager"
   - Устройство должно быть в статусе "Online"

3. **Синхронизация Gradle:**
   - File → Sync Project with Gradle Files

4. **Проверка структуры проекта:**
   - Убедитесь, что папка `app/src/androidTest/java` помечена как "Android Test Sources Root"
   - Правый клик на папке → Mark Directory as → Android Test Sources Root

5. **Запуск тестов:**
   - Откройте файл `app/src/androidTest/java/com/example/vkbookandroid/VkBookAndroidInstrumentedTests.kt`
   - Правый клик на имени класса → Run 'VkBookAndroidInstrumentedTests'
   - **ВАЖНО:** Выберите правильное устройство в выпадающем списке перед запуском

6. **Если тесты не видны:**
   - Build → Rebuild Project
   - File → Invalidate Caches → Invalidate and Restart
   - Проверьте, что устройство подключено: View → Tool Windows → Device Manager

## 3. Частые проблемы и решения

### Проблема: "No tests found"
**Решение:**
1. Проверьте, что файлы находятся в правильных папках:
   - Unit тесты: `app/src/test/java/`
   - Инструментальные тесты: `app/src/androidTest/java/`

2. Проверьте аннотации:
   - Unit тесты должны иметь `@RunWith(RobolectricTestRunner::class)` или `@RunWith(Suite::class)`
   - Инструментальные тесты должны иметь `@RunWith(AndroidJUnit4::class)`
   - Методы тестов должны иметь `@Test`

3. Синхронизация Gradle:
   - File → Sync Project with Gradle Files
   - Build → Rebuild Project

### Проблема: "No connected devices"
**Решение:**
1. Для инструментальных тестов обязательно нужно устройство
2. Запустите эмулятор: Tools → Device Manager → Create Device
3. Или подключите физическое устройство и включите "Отладка по USB"

### Проблема: Тесты не компилируются
**Решение:**
1. Проверьте зависимости в `app/build.gradle.kts`:
   ```kotlin
   testImplementation(libs.junit)
   androidTestImplementation(libs.androidx.junit)
   androidTestImplementation(libs.androidx.espresso.core)
   ```

2. Синхронизация Gradle:
   - File → Sync Project with Gradle Files

### Проблема: Android Studio не видит тесты
**Решение:**
1. Invalidate Caches:
   - File → Invalidate Caches → Invalidate and Restart

2. Пересборка проекта:
   - Build → Clean Project
   - Build → Rebuild Project

3. Проверка структуры проекта:
   - View → Tool Windows → Project
   - Убедитесь, что папки `test` и `androidTest` видны

## 4. Быстрая проверка

### Проверка unit тестов:
```bash
.\gradlew.bat testDebugUnitTest
```

### Проверка инструментальных тестов (требует устройство):
```bash
adb devices
.\gradlew.bat connectedDebugAndroidTest
```

## 5. Структура тестов

### Unit тесты (`app/src/test/java/`):
- `VkBookAndroidTests.kt` - основные unit тесты
- `SyncServiceTests.kt` - тесты синхронизации
- `ServerConnectionTests.kt` - тесты подключения к серверу
- `AllUnitTestsSuite.kt` - Suite для всех unit тестов

### Инструментальные тесты (`app/src/androidTest/java/`):
- `VkBookAndroidInstrumentedTests.kt` - основные инструментальные тесты
- `SyncIntegrationTests.kt` - интеграционные тесты синхронизации
- `SearchTests.kt` - тесты поиска
- `ErrorHandlingTests.kt` - тесты обработки ошибок
- `AllTestsSuite.kt` - Suite для всех инструментальных тестов
- И другие...

## 6. Рекомендации

1. **Всегда синхронизируйте Gradle** после изменений в `build.gradle.kts`
2. **Для инструментальных тестов** всегда проверяйте наличие подключенного устройства
3. **Используйте командную строку** для быстрой проверки всех тестов
4. **Используйте Android Studio** для отладки конкретных тестов

