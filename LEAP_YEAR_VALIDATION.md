# üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∏—Å–æ–∫–æ—Å–Ω—ã—Ö –≥–æ–¥–æ–≤ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

## –î–∞—Ç–∞: 22.10.2025

---

## ‚úÖ –ü–†–û–í–ï–†–ö–ê 1: –í–∏—Å–æ–∫–æ—Å–Ω—ã–µ –≥–æ–¥–∞ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è

### –ú–µ—Å—Ç–∞ —É—á–µ—Ç–∞:

1. **`generateScheduleData` (—Å—Ç—Ä–æ–∫–∞ 218-220):**
   ```kotlin
   val daysInMonths = intArrayOf(31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31)
   if (isLeapYear(currentYear)) {
       daysInMonths[1] = 29  // ‚úÖ –§–µ–≤—Ä–∞–ª—å = 29 –¥–Ω–µ–π
   }
   ```

2. **`calculateMonthShift` - –ø–µ—Ä–µ—Ö–æ–¥ –ù–ê–ó–ê–î (—Å—Ç—Ä–æ–∫–∞ 664):**
   ```kotlin
   val daysInYear = if (isLeapYear(year)) 366 else 365  // ‚úÖ –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è
   ```

3. **`calculateMonthShiftInternal` (—Å—Ç—Ä–æ–∫–∞ 688-690):**
   ```kotlin
   val daysInMonths = intArrayOf(31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31)
   if (isLeapYear(year)) {
       daysInMonths[1] = 29  // ‚úÖ –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è
   }
   ```

**–í–´–í–û–î:** ‚úÖ –í–∏—Å–æ–∫–æ—Å–Ω—ã–µ –≥–æ–¥–∞ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –≤–æ –≤—Å–µ—Ö –º–µ—Å—Ç–∞—Ö!

---

## ‚ùå –ü–†–û–ë–õ–ï–ú–ê: –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤ —Å—Ç—Ä–æ–∫–µ 247

### –¢–µ–∫—É—â–∏–π –∫–æ–¥:

```kotlin
val safeAdjustedShift = if (adjustedShift < 0 || adjustedShift + daysInMonths[monthIndex] > 36) {
    Log.w(TAG, "–í–ù–ò–ú–ê–ù–ò–ï: $monthName adjusted=$adjustedShift –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã!")
    (adjustedShift % 10 + 10) % 10  // ‚ùå –ù–ï –ü–†–û–í–ï–†–Ø–ï–¢ –ü–û–ú–ï–©–ï–ù–ò–ï!
} else {
    adjustedShift
}
```

### –ü—Ä–æ–±–ª–µ–º—ã:

1. **–ù–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–º–µ—â–µ–Ω–∏–µ –º–µ—Å—è—Ü–∞:**
   ```
   adjusted = -4
   normalized = (-4 % 10 + 10) % 10 = 6
   
   –ï—Å–ª–∏ –º–µ—Å—è—Ü = 31 –¥–µ–Ω—å:
   6 + 31 = 37 > 36 ‚ùå –ù–ï –ü–û–ú–ï–©–ê–ï–¢–°–Ø!
   ```

2. **–ú–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –Ω–∞–ª–æ–∂–µ–Ω–∏—è:**
   - –ï—Å–ª–∏ normalized + daysInMonth > 36, —Ç–æ –¥–Ω–∏ –æ–±—Ä–µ–∂—É—Ç—Å—è (—Å—Ç—Ä–æ–∫–∞ 267: `take(36)`)
   - –ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–Ω–∏ –º–µ—Å—è—Ü–∞ **–∏—Å—á–µ–∑–Ω—É—Ç**!

---

## ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û–ï –†–ï–®–ï–ù–ò–ï

### –ù—É–∂–Ω–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–º–µ—â–µ–Ω–∏–µ –º–µ—Å—è—Ü–∞:

```kotlin
val safeAdjustedShift = if (adjustedShift < 0 || adjustedShift + daysInMonths[monthIndex] > 36) {
    Log.w(TAG, "–í–ù–ò–ú–ê–ù–ò–ï: $monthName adjusted=$adjustedShift –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã!")
    
    // –ò—â–µ–º –±–µ–∑–æ–ø–∞—Å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é —Å —Ç–µ–º –∂–µ –∑–Ω–∞—á–µ–Ω–∏–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω–∞
    val patternValue = calculatedShift % 10
    val maxSafePosition = 36 - daysInMonths[monthIndex]
    
    // –í–æ–∑–º–æ–∂–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏: patternValue, patternValue - 10, patternValue - 20, ...
    var safePosition = patternValue
    while (safePosition > maxSafePosition && safePosition > 0) {
        safePosition -= 10
    }
    
    // –ï—Å–ª–∏ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞—è –∏–ª–∏ –Ω–µ –ø–æ–º–µ—â–∞–µ—Ç—Å—è, –∏—Å–ø–æ–ª—å–∑—É–µ–º 0
    if (safePosition < 0 || safePosition + daysInMonths[monthIndex] > 36) {
        0
    } else {
        safePosition
    }
} else {
    adjustedShift
}
```

---

## üßÆ –¢–ï–°–¢–û–í–´–ï –°–õ–£–ß–ê–ò

### –¢–µ—Å—Ç 1: –û–±—ã—á–Ω—ã–π –≥–æ–¥ (2025)

```
–Ø–ù–í–ê–†–¨ (31 –¥–µ–Ω—å):
  calculated = 1
  adjusted = 1 - 0 = 1
  1 + 31 = 32 ‚â§ 36 ‚úÖ –ü–æ–º–µ—â–∞–µ—Ç—Å—è

–§–ï–í–†–ê–õ–¨ (28 –¥–Ω–µ–π):
  calculated = 2
  adjusted = 2 - 0 = 2
  2 + 28 = 30 ‚â§ 36 ‚úÖ –ü–æ–º–µ—â–∞–µ—Ç—Å—è

–ú–ê–†–¢ (31 –¥–µ–Ω—å):
  calculated = 0
  adjusted = 0 - 0 = 0
  0 + 31 = 31 ‚â§ 36 ‚úÖ –ü–æ–º–µ—â–∞–µ—Ç—Å—è
```

### –¢–µ—Å—Ç 2: –í–∏—Å–æ–∫–æ—Å–Ω—ã–π –≥–æ–¥ (2024)

```
–Ø–ù–í–ê–†–¨ (31 –¥–µ–Ω—å):
  calculated = 5
  adjusted = 5 - 0 = 5
  5 + 31 = 36 ‚â§ 36 ‚úÖ –ü–æ–º–µ—â–∞–µ—Ç—Å—è

–§–ï–í–†–ê–õ–¨ (29 –¥–Ω–µ–π):
  calculated = 6
  adjusted = 6 - 0 = 6
  6 + 29 = 35 ‚â§ 36 ‚úÖ –ü–æ–º–µ—â–∞–µ—Ç—Å—è

–ú–ê–†–¢ (31 –¥–µ–Ω—å):
  calculated = 0
  adjusted = 0 - 0 = 0
  0 + 31 = 31 ‚â§ 36 ‚úÖ –ü–æ–º–µ—â–∞–µ—Ç—Å—è
```

### –¢–µ—Å—Ç 3: –ü—Ä–æ–±–ª–µ–º–Ω—ã–π –≥–æ–¥ (2026)

```
yearShiftOffset = 6

–Ø–ù–í–ê–†–¨ (31 –¥–µ–Ω—å):
  calculated = 6
  adjusted = 6 - 6 = 0
  0 + 31 = 31 ‚â§ 36 ‚úÖ –ü–æ–º–µ—â–∞–µ—Ç—Å—è

–§–ï–í–†–ê–õ–¨ (28 –¥–Ω–µ–π):
  calculated = 2
  adjusted = 2 - 6 = -4 ‚ùå –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π!
  
  –¢–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞:
    normalized = (-4 % 10 + 10) % 10 = 6
    6 + 28 = 34 ‚â§ 36 ‚úÖ –ü–æ–º–µ—â–∞–µ—Ç—Å—è (—Å–ª—É—á–∞–π–Ω–æ!)
  
  –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞:
    patternValue = 2
    maxSafePosition = 36 - 28 = 8
    safePosition = 2 (—É–∂–µ ‚â§ 8)
    2 + 28 = 30 ‚â§ 36 ‚úÖ –ü–æ–º–µ—â–∞–µ—Ç—Å—è

–ú–ê–†–¢ (31 –¥–µ–Ω—å):
  calculated = 7
  adjusted = 7 - 6 = 1
  1 + 31 = 32 ‚â§ 36 ‚úÖ –ü–æ–º–µ—â–∞–µ—Ç—Å—è
```

---

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –°–õ–£–ß–ê–ô

### –ß—Ç–æ –µ—Å–ª–∏ yearShiftOffset –æ—á–µ–Ω—å –±–æ–ª—å—à–æ–π?

```
yearShiftOffset = 15 (–≥–∏–ø–æ—Ç–µ—Ç–∏—á–µ—Å–∫–∏)

–§–ï–í–†–ê–õ–¨ (28 –¥–Ω–µ–π):
  calculated = 2
  adjusted = 2 - 15 = -13
  
  –¢–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞:
    normalized = (-13 % 10 + 10) % 10 = 7
    7 + 28 = 35 ‚â§ 36 ‚úÖ –°–ª—É—á–∞–π–Ω–æ –ø–æ–º–µ—â–∞–µ—Ç—Å—è
  
  –ù–û! –≠—Ç–æ –ù–ï–ü–†–ê–í–ò–õ–¨–ù–ê–Ø –ø–æ–∑–∏—Ü–∏—è –≤ –ø–∞—Ç—Ç–µ—Ä–Ω–µ!
  calculated = 2 –æ–∑–Ω–∞—á–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é "4" –≤ –±–∞–∑–æ–≤–æ–º –ø–∞—Ç—Ç–µ—Ä–Ω–µ
  normalized = 7 –æ–∑–Ω–∞—á–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é "2" –≤ –±–∞–∑–æ–≤–æ–º –ø–∞—Ç—Ç–µ—Ä–Ω–µ
  ‚ùå –†–ê–°–°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø!
```

---

## ‚úÖ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### 1. –£–ª—É—á—à–∏—Ç—å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é (–ö–†–ò–¢–ò–ß–ù–û!)

–ó–∞–º–µ–Ω–∏—Ç—å —Å—Ç—Ä–æ–∫—É 247 –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ª–æ–≥–∏–∫—É –ø–æ–∏—Å–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–∞—Ç—Ç–µ—Ä–Ω–∞.

### 2. –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é

–ü–æ—Å–ª–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è `safeAdjustedShift` –ø—Ä–æ–≤–µ—Ä—è—Ç—å:
```kotlin
if (safeAdjustedShift + daysInMonths[monthIndex] > 36) {
    Log.e(TAG, "–û–®–ò–ë–ö–ê: $monthName –Ω–µ –ø–æ–º–µ—â–∞–µ—Ç—Å—è! safe=$safeAdjustedShift, –¥–Ω–µ–π=${daysInMonths[monthIndex]}")
    // –ê–≤–∞—Ä–∏–π–Ω—ã–π fallback
}
```

### 3. –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å yearShiftOffset

```kotlin
val yearShiftOffset = (januaryCalculatedShift - januaryAdjustedShift).coerceIn(-10, 10)
```

–≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ —Å–¥–≤–∏–≥ –Ω–µ –±—É–¥–µ—Ç —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∏–º.

### 4. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏

–ü–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤—Å–µ—Ö –º–µ—Å—è—Ü–µ–≤:
```kotlin
// –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ –º–µ—Å—è—Ü—ã –ø–æ–º–µ—â–∞—é—Ç—Å—è
months.forEachIndexed { monthIndex, monthName ->
    val row = scheduleData[monthIndex]
    val nonEmptyCount = row.days.count { it.toString().isNotEmpty() && it.toString().toIntOrNull() != null }
    val expectedDays = daysInMonths[monthIndex]
    
    if (nonEmptyCount != expectedDays) {
        Log.e(TAG, "–û–®–ò–ë–ö–ê: $monthName –∏–º–µ–µ—Ç $nonEmptyCount –¥–Ω–µ–π –≤–º–µ—Å—Ç–æ $expectedDays!")
    }
}
```

---

## üìä –ü–†–û–í–ï–†–ö–ê –í–ò–°–û–ö–û–°–ù–´–• –ì–û–î–û–í

### 2024 (–≤–∏—Å–æ–∫–æ—Å–Ω—ã–π):
- –§–µ–≤—Ä–∞–ª—å = 29 –¥–Ω–µ–π ‚úÖ
- –ì–æ–¥ = 366 –¥–Ω–µ–π ‚úÖ
- –ü–µ—Ä–µ—Ö–æ–¥ 2024‚Üí2025 —É—á–∏—Ç—ã–≤–∞–µ—Ç 366 –¥–Ω–µ–π ‚úÖ

### 2028 (–≤–∏—Å–æ–∫–æ—Å–Ω—ã–π):
- –§–µ–≤—Ä–∞–ª—å = 29 –¥–Ω–µ–π ‚úÖ
- –ü–µ—Ä–µ—Ö–æ–¥ 2028‚Üí2029 —É—á–∏—Ç—ã–≤–∞–µ—Ç 366 –¥–Ω–µ–π ‚úÖ

### 2100 (–ù–ï –≤–∏—Å–æ–∫–æ—Å–Ω—ã–π, —Ö–æ—Ç—è –¥–µ–ª–∏—Ç—Å—è –Ω–∞ 4!):
- –ü—Ä–∞–≤–∏–ª–æ: –≥–æ–¥ % 100 == 0 && –≥–æ–¥ % 400 != 0 ‚Üí –ù–ï –≤–∏—Å–æ–∫–æ—Å–Ω—ã–π
- `isLeapYear(2100)` –≤–µ—Ä–Ω–µ—Ç `false` ‚úÖ
- –§–µ–≤—Ä–∞–ª—å = 28 –¥–Ω–µ–π ‚úÖ

---

## ‚úÖ –í–´–í–û–î

### –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
1. ‚úÖ –í–∏—Å–æ–∫–æ—Å–Ω—ã–µ –≥–æ–¥–∞ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è
2. ‚úÖ –§–µ–≤—Ä–∞–ª—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏–º–µ–µ—Ç 28/29 –¥–Ω–µ–π
3. ‚úÖ –ü–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É –≥–æ–¥–∞–º–∏ —É—á–∏—Ç—ã–≤–∞—é—Ç 365/366 –¥–Ω–µ–π
4. ‚úÖ `isLeapYear` –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω

### –ß—Ç–æ –Ω—É–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å:
1. ‚ùå **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤ —Å—Ç—Ä–æ–∫–µ 247** - –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
2. ‚ö†Ô∏è –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–º–µ—â–µ–Ω–∏—è –º–µ—Å—è—Ü–µ–≤
3. ‚ö†Ô∏è –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –ø–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:
**–°—Ä–æ—á–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é** –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º –≤ –∫—Ä–∞–π–Ω–∏—Ö —Å–ª—É—á–∞—è—Ö!






