# –ú–µ—Ö–∞–Ω–∏–∑–º –ø–æ–∏—Å–∫–∞ –ø–æ—Å–ª–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∫—ç—à–∞ –¥–æ 50,000 —Å—Ç—Ä–æ–∫

## –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ–∏—Å–∫–∞

**–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `ArmatureFragment.performEnhancedSearch()`

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∫—ç—à –≤ –ø–∞–º—è—Ç–∏ (`cachedSearchData`)
2. –ï—Å–ª–∏ –∫—ç—à –ø—É—Å—Ç:
   - –ë–µ—Ä–µ—Ç—Å—è `originalData` –∏–∑ –∞–¥–∞–ø—Ç–µ—Ä–∞ (–ø–µ—Ä–≤—ã–µ ~2000 —Å—Ç—Ä–æ–∫)
   - –ß–∏—Ç–∞—é—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ `session.readRange()` –ø–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω–æ
   - –í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è –∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `cachedSearchData`

**–ö–æ–¥:**
```kotlin
val session = cachedSession ?: pagingSession
var cursor = originalData.size
while (session != null) {
    val next = session.readRange(cursor, pageSize) // pageSize = 500
    if (next.isEmpty()) break
    combined.addAll(next)
    cursor += next.size
}
```

### 2. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ—Å–ª–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∫—ç—à–∞ –¥–æ 50,000 —Å—Ç—Ä–æ–∫:
- `CachedExcelPagingSession.readRange()` —á–∏—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∏–∑ JSON —Ñ–∞–π–ª–æ–≤ –∫—ç—à–∞
- –ú–∞–∫—Å–∏–º—É–º –¥–æ—Å—Ç—É–ø–Ω–æ: 50,000 —Å—Ç—Ä–æ–∫
- –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å–∏—Ç—å —Å—Ç—Ä–æ–∫–∏ –ø–æ—Å–ª–µ 50,000 ‚Üí –≤–µ—Ä–Ω–µ—Ç—Å—è –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–∏—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ –ø–µ—Ä–≤—ã–º 50,000 —Å—Ç—Ä–æ–∫–∞–º

---

## –°–∫–æ—Ä–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –î–∞–Ω–Ω—ã–µ –≤ –∫—ç—à–µ (–ø–µ—Ä–≤—ã–µ 50,000 —Å—Ç—Ä–æ–∫)

**–ú–µ—Ö–∞–Ω–∏–∑–º:**
- –î–∞–Ω–Ω—ã–µ —á–∏—Ç–∞—é—Ç—Å—è –∏–∑ JSON —Ñ–∞–π–ª–æ–≤ –Ω–∞ –¥–∏—Å–∫–µ
- –ë—ã—Å—Ç—Ä–æ: —á—Ç–µ–Ω–∏–µ —Å –¥–∏—Å–∫–∞, –±–µ–∑ –ø–∞—Ä—Å–∏–Ω–≥–∞ Excel

**–°–∫–æ—Ä–æ—Å—Ç—å:**
- –ü–µ—Ä–≤—ã–π –ø–æ–∏—Å–∫: ~1-2 —Å–µ–∫—É–Ω–¥—ã (–∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –ø–∞–º—è—Ç—å)
- –ü–æ—Å–ª–µ–¥—É—é—â–∏–µ –ø–æ–∏—Å–∫–∏: **–º–≥–Ω–æ–≤–µ–Ω–Ω–æ** (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `cachedSearchData` –≤ –ø–∞–º—è—Ç–∏)

**–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- `cachedSearchData` –≤ –ø–∞–º—è—Ç–∏ (RAM) - —Ö—Ä–∞–Ω–∏—Ç—Å—è –¥–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
- `SearchManager.searchCache` - –∫—ç—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞ (60 —Å–µ–∫—É–Ω–¥)

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –î–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ 50,000 —Å—Ç—Ä–æ–∫

**–¢–µ–∫—É—â–µ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:**
- ‚ùå **–ù–ï –∏—â–µ—Ç—Å—è** - –¥–∞–Ω–Ω—ã–µ –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤ –∫—ç—à
- `readRange()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ –ø–æ—Å–ª–µ 50,000 —Å—Ç—Ä–æ–∫

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–∏—Å–∫ –Ω–µ –Ω–∞–π–¥–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ 50,000 —Å—Ç—Ä–æ–∫

---

## –ú–µ—Ö–∞–Ω–∏–∑–º—ã –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

### 1. –ö—ç—à –Ω–∞ –¥–∏—Å–∫–µ (ExcelCacheManager)
- **–§–æ—Ä–º–∞—Ç:** JSON —Ñ–∞–π–ª—ã (`pages/page_XXXXX.json`)
- **–†–∞–∑–º–µ—Ä:** –î–æ 50,000 —Å—Ç—Ä–æ–∫ –Ω–∞ —Ñ–∞–π–ª (~20 –ú–ë)
- **–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `filesDir/excel_cache/`
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ Excel —Ñ–∞–π–ª–∞

### 2. –ö—ç—à –≤ –ø–∞–º—è—Ç–∏ (ArmatureFragment)
- **–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è:** `cachedSearchData: List<RowDataDynamic>?`
- **–†–∞–∑–º–µ—Ä:** –î–æ 50,000 —Å—Ç—Ä–æ–∫ (~20-40 –ú–ë –≤ RAM)
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** –ü—Ä–∏ –≤—ã–∑–æ–≤–µ `refreshData()` –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- **–û—á–∏—Å—Ç–∫–∞:** –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞

### 3. –ö—ç—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞ (SearchManager)
- **–¢–∏–ø:** `TimestampedCache<String, List<SearchResult>>`
- **–†–∞–∑–º–µ—Ä:** –î–æ 100 –∑–∞–ø—Ä–æ—Å–æ–≤
- **–í—Ä–µ–º—è –∂–∏–∑–Ω–∏:** 60 —Å–µ–∫—É–Ω–¥
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ `notifyDataChanged()`

---

## –í–∞—Ä–∏–∞–Ω—Ç—ã —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã –ø–æ–∏—Å–∫–∞ –ø–æ—Å–ª–µ 50,000 —Å—Ç—Ä–æ–∫

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è) ‚≠ê

**–°—É—Ç—å:** 
- –ü–æ–∏—Å–∫ –ø–æ –∫—ç—à—É (–ø–µ—Ä–≤—ã–µ 50,000 —Å—Ç—Ä–æ–∫) - –±—ã—Å—Ç—Ä–æ
- –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ ‚Üí –ø–æ–∏—Å–∫ –ø–æ –∏—Å—Ö–æ–¥–Ω–æ–º—É Excel —Ñ–∞–π–ª—É (–æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏) - –º–µ–¥–ª–µ–Ω–Ω–µ–µ

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –ø–æ –ø–µ—Ä–≤—ã–º —Å—Ç—Ä–æ–∫–∞–º (–≤ –∫—ç—à–µ)
- ‚úÖ –ü–æ–ª–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ –≤—Å–µ–º—É —Ñ–∞–π–ª—É
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫—ç—à–∞

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- ‚ùå –ü–æ–∏—Å–∫ –ø–æ –æ—Å—Ç–∞–ª—å–Ω—ã–º —Å—Ç—Ä–æ–∫–∞–º –º–µ–¥–ª–µ–Ω–Ω–µ–µ (—á—Ç–µ–Ω–∏–µ Excel)

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```kotlin
// 1. –ü–æ–∏—Å–∫ –≤ –∫—ç—à–µ (–±—ã—Å—Ç—Ä–æ)
val cachedResults = searchInCachedData(query)

// 2. –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –∏–ª–∏ –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ ‚Üí –ø–æ–∏—Å–∫ –≤ –∏—Å—Ö–æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ
if (cachedResults.isEmpty() || needMoreResults) {
    val fileResults = excelRepository.searchInAllArmatures(query)
    // –û–±—ä–µ–¥–∏–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
}
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –£–≤–µ–ª–∏—á–∏—Ç—å –ª–∏–º–∏—Ç –∫—ç—à–∞

**–°—É—Ç—å:** –£–≤–µ–ª–∏—á–∏—Ç—å `MAX_CACHED_ROWS_PER_FILE` –¥–æ 100,000 —Å—Ç—Ä–æ–∫

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ü—Ä–æ—Å—Ç–æ—Ç–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- ‚úÖ –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –ø–æ –±–æ–ª—å—à–µ–º—É –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —Å—Ç—Ä–æ–∫

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- ‚ùå –£–≤–µ–ª–∏—á–∏—Ç—Å—è —Ä–∞–∑–º–µ—Ä –∫—ç—à–∞ (~40 –ú–ë –Ω–∞ —Ñ–∞–π–ª)
- ‚ùå –ú–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—Å–∏—Ç—å –ª–∏–º–∏—Ç 80 –ú–ë –ø—Ä–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ñ–∞–π–ª–∞—Ö

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –ª–∏–º–∏—Ç

**–°—É—Ç—å:** –†–∞–∑–Ω—ã–µ –ª–∏–º–∏—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–∞–∑–º–µ—Ä–∞

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –º–µ—Å—Ç–∞
- ‚úÖ –ë–æ–ª—å—à–µ —Å—Ç—Ä–æ–∫ –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- ‚ùå –°–ª–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- ‚ùå –ù—É–∂–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

---

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

**–í–∞—Ä–∏–∞–Ω—Ç 1 (–ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫)** - –ª—É—á—à–∏–π –≤—ã–±–æ—Ä:

1. **–ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫** –ø–æ –ø–µ—Ä–≤—ã–º 50,000 —Å—Ç—Ä–æ–∫–∞–º (–≤ –∫—ç—à–µ)
2. **–ü–æ–ª–Ω—ã–π –ø–æ–∏—Å–∫** –ø–æ –≤—Å–µ–º—É —Ñ–∞–π–ª—É –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
3. **–ù–µ —Ç—Ä–µ–±—É–µ—Ç** –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –∫—ç—à–∞
4. **–ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç** –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏–µ –≤—Å–µ—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

**–û—Ü–µ–Ω–∫–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏:**
- –ü–æ–∏—Å–∫ –≤ –∫—ç—à–µ: **–º–≥–Ω–æ–≤–µ–Ω–Ω–æ** (–¥–∞–Ω–Ω—ã–µ –≤ –ø–∞–º—è—Ç–∏)
- –ü–æ–∏—Å–∫ –≤ —Ñ–∞–π–ª–µ: **1-3 —Å–µ–∫—É–Ω–¥—ã** (—á—Ç–µ–Ω–∏–µ –∏ –ø–∞—Ä—Å–∏–Ω–≥ Excel)

---

## –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- ‚úÖ –ü–æ–∏—Å–∫ –ø–æ –ø–µ—Ä–≤—ã–º 50,000 —Å—Ç—Ä–æ–∫–∞–º - **–±—ã—Å—Ç—Ä–æ**
- ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞ - **–º–≥–Ω–æ–≤–µ–Ω–Ω–æ**
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞

### –ß—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- ‚ùå –ü–æ–∏—Å–∫ –ø–æ —Å—Ç—Ä–æ–∫–∞–º –ø–æ—Å–ª–µ 50,000 - **–Ω–µ –∏—â–µ—Ç—Å—è**

### –ß—Ç–æ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å:
- üîß –î–æ–±–∞–≤–∏—Ç—å fallback –ø–æ–∏—Å–∫ –ø–æ –∏—Å—Ö–æ–¥–Ω–æ–º—É Excel —Ñ–∞–π–ª—É
- üîß –û–±—ä–µ–¥–∏–Ω—è—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–∑ –∫—ç—à–∞ –∏ —Ñ–∞–π–ª–∞

